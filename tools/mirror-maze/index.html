<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mirror Maze - Vibe Coding</title>
    <meta name="description" content="Dual-board puzzle game where your shadow moves opposite. Reach both exits simultaneously!">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- DaisyUI -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.9.4/dist/full.css" rel="stylesheet" type="text/css" />
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#8B5CF6',
                        secondary: '#06B6D4',
                        accent: '#F59E0B',
                    }
                }
            }
        }
    </script>
    
    <style>
        .game-board {
            display: grid;
            gap: 2px;
            background: #1f2937;
            padding: 10px;
            border-radius: 8px;
            border: 3px solid #374151;
        }
        
        .cell {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s ease;
            position: relative;
            font-size: 18px;
        }
        
        .cell-floor {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
        }
        
        .cell-wall {
            background: #374151;
            border: 1px solid #1f2937;
        }
        
        .cell-exit {
            background: linear-gradient(45deg, #10b981, #059669);
            border: 2px solid #047857;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
        }
        
        .cell-switch {
            background: #fbbf24;
            border: 2px solid #f59e0b;
        }
        
        .cell-door {
            background: #ef4444;
            border: 2px solid #dc2626;
        }
        
        .cell-door.open {
            background: #6b7280;
            border: 2px solid #4b5563;
        }
        
        .cell-trap {
            background: #dc2626;
            border: 2px solid #b91c1c;
            box-shadow: 0 0 15px rgba(220, 38, 38, 0.3);
        }
        
        .player {
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: pulse 2s infinite;
        }
        
        .player-real {
            color: #8b5cf6;
        }
        
        .player-mirror {
            color: #06b6d4;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes victory {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .victory-animation {
            animation: victory 0.8s ease-in-out;
        }
        
        .game-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .level-indicator {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
        
        .controls-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
        
        .game-stats {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
        
        @media (max-width: 768px) {
            .cell {
                width: 30px;
                height: 30px;
                font-size: 14px;
            }
            
            .player {
                font-size: 18px;
            }
        }
        
        .hint-panel {
            background: rgba(255, 255, 255, 0.95);
            border-left: 4px solid #8b5cf6;
        }
    </style>
</head>
<body class="game-container" x-data="mirrorMazeGame()">
    
    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-md shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="../../" class="btn btn-ghost btn-sm">
                        <i class="fas fa-arrow-left mr-2"></i>
                        <span class="hidden md:inline">Back to Hub</span>
                    </a>
                    <div class="flex items-center space-x-2">
                        <div class="text-2xl md:text-3xl">🪞</div>
                        <div>
                            <h1 class="text-lg md:text-2xl font-bold text-gray-800">
                                Mirror Maze
                            </h1>
                            <p class="text-xs md:text-sm text-gray-600 hidden sm:block">Dual-board puzzle adventure</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button @click="showLevelSelect = true" class="btn btn-primary btn-sm">
                        <i class="fas fa-list"></i>
                        <span class="hidden md:inline">Levels</span>
                    </button>
                    <button @click="showInstructions = true" class="btn btn-ghost btn-sm">
                        <i class="fas fa-question-circle"></i>
                        <span class="hidden md:inline">Help</span>
                    </button>
                    <button @click="resetLevel()" class="btn btn-outline btn-sm">
                        <i class="fas fa-redo"></i>
                        <span class="hidden md:inline">Reset</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Game Stats -->
    <div class="container mx-auto px-4 py-4">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="game-stats rounded-lg p-4 text-center cursor-pointer hover:bg-purple-50 transition-colors" @click="showLevelSelect = true">
                <div class="text-2xl font-bold text-purple-600" x-text="currentLevel"></div>
                <div class="text-sm text-gray-600">Level <i class="fas fa-chevron-down text-xs"></i></div>
            </div>
            <div class="game-stats rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-blue-600" x-text="moves"></div>
                <div class="text-sm text-gray-600">Moves</div>
            </div>
            <div class="game-stats rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-green-600" x-text="completedLevels"></div>
                <div class="text-sm text-gray-600">Completed</div>
            </div>
            <div class="game-stats rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-orange-600" x-text="formatTime(levelTime)"></div>
                <div class="text-sm text-gray-600">Level Time</div>
            </div>
        </div>
    </div>

    <!-- Game Boards -->
    <div class="container mx-auto px-4 pb-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Real World Board -->
            <div class="space-y-4">
                <div class="level-indicator rounded-lg p-4 text-center">
                    <h3 class="text-lg font-bold text-purple-600 mb-2">
                        <i class="fas fa-user mr-2"></i>Real World
                    </h3>
                    <p class="text-sm text-gray-600">Your avatar moves normally</p>
                </div>
                
                <div class="flex justify-center">
                    <div 
                        class="game-board"
                        :style="`grid-template-columns: repeat(${boardSize}, 1fr); grid-template-rows: repeat(${boardSize}, 1fr);`"
                    >
                        <template x-for="(row, rowIndex) in board" :key="'real-' + rowIndex">
                            <template x-for="(cell, colIndex) in row" :key="'real-' + rowIndex + '-' + colIndex">
                                <div 
                                    class="cell"
                                    :class="getCellClass(cell, 'real')"
                                >
                                    <span x-show="playerReal.x === colIndex && playerReal.y === rowIndex" 
                                          class="player player-real">👤</span>
                                    <span x-show="cell === 'exit'" class="text-white">🚪</span>
                                    <span x-show="cell === 'switch'" class="text-white">⚡</span>
                                    <span x-show="cell === 'door'" class="text-white">🚫</span>
                                    <span x-show="cell === 'door_open'" class="text-white">⬜</span>
                                    <span x-show="cell === 'trap'" class="text-white">💀</span>
                                </div>
                            </template>
                        </template>
                    </div>
                </div>
            </div>
            
            <!-- Mirror World Board -->
            <div class="space-y-4">
                <div class="level-indicator rounded-lg p-4 text-center">
                    <h3 class="text-lg font-bold text-blue-600 mb-2">
                        <i class="fas fa-user-secret mr-2"></i>Mirror World
                    </h3>
                    <p class="text-sm text-gray-600">Your shadow moves opposite</p>
                </div>
                
                <div class="flex justify-center">
                    <div 
                        class="game-board"
                        :style="`grid-template-columns: repeat(${boardSize}, 1fr); grid-template-rows: repeat(${boardSize}, 1fr);`"
                    >
                        <template x-for="(row, rowIndex) in mirrorBoard" :key="'mirror-' + rowIndex">
                            <template x-for="(cell, colIndex) in row" :key="'mirror-' + rowIndex + '-' + colIndex">
                                <div 
                                    class="cell"
                                    :class="getCellClass(cell, 'mirror')"
                                >
                                    <span x-show="playerMirror.x === colIndex && playerMirror.y === rowIndex" 
                                          class="player player-mirror">👥</span>
                                    <span x-show="cell === 'exit'" class="text-white">🚪</span>
                                    <span x-show="cell === 'switch'" class="text-white">⚡</span>
                                    <span x-show="cell === 'door'" class="text-white">🚫</span>
                                    <span x-show="cell === 'door_open'" class="text-white">⬜</span>
                                    <span x-show="cell === 'trap'" class="text-white">💀</span>
                                </div>
                            </template>
                        </template>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Game Controls -->
        <div class="mt-8">
            <div class="controls-panel rounded-lg p-6">
                <h3 class="text-lg font-bold text-center mb-4">Controls</h3>
                <div class="grid grid-cols-3 gap-2 max-w-xs mx-auto">
                    <div></div>
                    <button @click="movePlayer('up')" class="btn btn-outline btn-lg">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                    <div></div>
                    <button @click="movePlayer('left')" class="btn btn-outline btn-lg">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <button @click="resetLevel()" class="btn btn-ghost btn-lg">
                        <i class="fas fa-redo"></i>
                    </button>
                    <button @click="movePlayer('right')" class="btn btn-outline btn-lg">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                    <div></div>
                    <button @click="movePlayer('down')" class="btn btn-outline btn-lg">
                        <i class="fas fa-arrow-down"></i>
                    </button>
                    <div></div>
                </div>
                <p class="text-center text-sm text-gray-600 mt-4">
                    Use arrow keys or buttons to move. Both avatars must reach their exits!
                </p>
            </div>
        </div>
        
        <!-- Hint Panel -->
        <div class="mt-6" x-show="showHint">
            <div class="hint-panel rounded-lg p-4">
                <h4 class="font-bold text-purple-600 mb-2">💡 Level Hint:</h4>
                <p class="text-sm text-gray-700" x-text="getCurrentHint()"></p>
                <button @click="showHint = false" class="btn btn-xs btn-ghost mt-2">
                    <i class="fas fa-times"></i> Hide
                </button>
            </div>
        </div>
    </div>

    <!-- Instructions Modal -->
    <div x-show="showInstructions" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
         @click.self="showInstructions = false">
        
        <div class="bg-white rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold">How to Play Mirror Maze</h2>
                    <button @click="showInstructions = false" class="btn btn-ghost btn-sm">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <h3 class="font-bold text-lg mb-2">🎯 Objective</h3>
                        <p class="text-gray-600">Guide both your real avatar (👤) and mirror shadow (👥) to their respective exits (🚪) simultaneously.</p>
                    </div>
                    
                    <div>
                        <h3 class="font-bold text-lg mb-2">🕹️ Controls</h3>
                        <ul class="text-gray-600 space-y-1">
                            <li>• <strong>Arrow Keys</strong> or <strong>Button Controls</strong> to move</li>
                            <li>• <strong>Real Avatar</strong>: Moves normally in all directions</li>
                            <li>• <strong>Mirror Avatar</strong>: Up/Down same, Left/Right mirrored</li>
                            <li>• <strong>Independent Movement</strong>: Each avatar can move if their path is clear</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h3 class="font-bold text-lg mb-2">🧩 Game Elements</h3>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div>🚪 <strong>Exit</strong> - Reach both!</div>
                            <div>⚡ <strong>Switch</strong> - Toggles doors</div>
                            <div>🚫 <strong>Door</strong> - Blocks movement</div>
                            <div>💀 <strong>Trap</strong> - Avoid at all costs!</div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="font-bold text-lg mb-2">💡 Strategy Tips</h3>
                        <ul class="text-gray-600 space-y-1">
                            <li>• Plan both avatars' paths simultaneously</li>
                            <li>• Use switches strategically to open doors</li>
                            <li>• Only left-right movement is mirrored</li>
                            <li>• Avatars can move independently if not blocked</li>
                            <li>• Both avatars must avoid traps</li>
                            <li>• <strong>Warning:</strong> Don't stand on doors when they close - you'll be trapped!</li>
                        </ul>
                    </div>
                </div>
                
                <div class="flex gap-4 mt-6">
                    <button @click="showInstructions = false; showHint = true" class="btn btn-primary flex-1">
                        Got it! Show Hint
                    </button>
                    <button @click="showInstructions = false" class="btn btn-outline">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Level Select Modal -->
    <div x-show="showLevelSelect" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
         @click.self="showLevelSelect = false">
        
        <div class="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h2 class="text-2xl font-bold">Select Level</h2>
                        <p class="text-sm text-gray-600">Currently on Level <span x-text="currentLevel" class="font-bold text-purple-600"></span></p>
                    </div>
                    <button @click="showLevelSelect = false" class="btn btn-ghost btn-sm">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="grid grid-cols-4 gap-3">
                    <template x-for="level in totalLevels" :key="level">
                        <button 
                            @click="loadLevel(level); showLevelSelect = false"
                            class="btn btn-sm"
                            :class="{
                                'btn-primary': level <= completedLevels + 1 && level !== currentLevel,
                                'btn-secondary': level === currentLevel,
                                'btn-disabled': level > completedLevels + 1
                            }"
                            :disabled="level > completedLevels + 1"
                        >
                            <div class="flex flex-col items-center">
                                <span x-text="level" class="text-lg font-bold"></span>
                                <div class="text-xs">
                                    <span x-show="level <= completedLevels">✓</span>
                                    <span x-show="level === currentLevel">📍</span>
                                    <span x-show="level > completedLevels + 1">🔒</span>
                                </div>
                            </div>
                        </button>
                    </template>
                </div>
                
                <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                    <p class="text-xs text-gray-600 text-center">
                        ✓ Completed • 📍 Current • 🔒 Locked
                    </p>
                </div>
                
                <div class="mt-6 text-center">
                    <button @click="showLevelSelect = false" class="btn btn-outline">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Level Complete Modal -->
    <div x-show="showLevelComplete" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 scale-100"
         x-transition:leave-end="opacity-0 scale-95"
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        
        <div class="bg-white rounded-xl max-w-md w-full">
            <div class="p-6 text-center">
                <!-- Celebration Header -->
                <div class="text-6xl mb-4">🎉</div>
                <h2 class="text-3xl font-bold text-green-600 mb-2">Level Complete!</h2>
                <p class="text-lg text-gray-600 mb-6">Congratulations! You solved Level <span x-text="currentLevel" class="font-bold text-purple-600"></span></p>
                
                <!-- Stats -->
                <div class="bg-gray-50 rounded-lg p-4 mb-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-blue-600" x-text="levelCompleteMoves"></div>
                            <div class="text-sm text-gray-600">Moves</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-orange-600" x-text="formatTime(levelCompleteTime)"></div>
                            <div class="text-sm text-gray-600">Time</div>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="space-y-3">
                    <button 
                        @click="nextLevel()" 
                        x-show="currentLevel < totalLevels"
                        class="btn btn-primary btn-lg w-full"
                    >
                        <i class="fas fa-arrow-right mr-2"></i>Next Level
                    </button>
                    
                    <div x-show="currentLevel >= totalLevels" class="mb-4">
                        <div class="text-2xl mb-2">🏆</div>
                        <p class="text-lg font-bold text-gold-600">All Levels Complete!</p>
                        <p class="text-sm text-gray-600">You've mastered the Mirror Maze!</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <button @click="showLevelComplete = false; resetLevel()" class="btn btn-outline">
                            <i class="fas fa-redo mr-2"></i>Play Again
                        </button>
                        <button @click="showLevelComplete = false; showLevelSelect = true" class="btn btn-ghost">
                            <i class="fas fa-list mr-2"></i>Select Level
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast toast-top toast-end z-[60]" x-show="showToast" x-transition>
        <div class="alert" :class="toastType === 'success' ? 'alert-success' : toastType === 'warning' ? 'alert-warning' : 'alert-error'">
            <i :class="toastType === 'success' ? 'fas fa-check' : toastType === 'warning' ? 'fas fa-exclamation-triangle' : 'fas fa-times-circle'"></i>
            <span x-text="toastMessage"></span>
        </div>
    </div>

    <!-- Welcome/Tutorial Modal -->
    <div x-show="showWelcome" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 scale-95"
         x-transition:enter-end="opacity-100 scale-100"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 scale-100"
         x-transition:leave-end="opacity-0 scale-95"
         class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[70] p-4">
        
        <div class="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <!-- Header -->
                <div class="text-center mb-6">
                    <div class="text-6xl mb-4">🪞</div>
                    <h2 class="text-3xl font-bold text-purple-600 mb-2">Welcome to Mirror Maze!</h2>
                    <p class="text-lg text-gray-600">The ultimate dual-board puzzle challenge</p>
                </div>
                
                <!-- Game Concept -->
                <div class="mb-8">
                    <div class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-6 mb-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-3">🎯 Game Concept</h3>
                        <p class="text-gray-700 mb-4">
                            Control <strong>two avatars simultaneously</strong> - your real character (👤) and its mirror reflection (👥). 
                            Guide both to their respective exits (🚪) at the same time to win each level!
                        </p>
                        <div class="bg-white rounded-lg p-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="text-center">
                                    <div class="text-3xl mb-2">👤</div>
                                    <h4 class="font-bold text-purple-600">Real World</h4>
                                    <p class="text-sm text-gray-600">Moves normally in all directions</p>
                                </div>
                                <div class="text-center">
                                    <div class="text-3xl mb-2">👥</div>
                                    <h4 class="font-bold text-blue-600">Mirror World</h4>
                                    <p class="text-sm text-gray-600">Left/Right mirrored, Up/Down same</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- How to Play -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <!-- Controls -->
                    <div class="bg-gray-50 rounded-lg p-5">
                        <h3 class="text-lg font-bold text-gray-800 mb-3">
                            <i class="fas fa-gamepad text-green-600 mr-2"></i>Controls
                        </h3>
                        <ul class="space-y-2 text-sm text-gray-700">
                            <li><strong>Arrow Keys</strong> or <strong>WASD</strong> - Move avatars</li>
                            <li><strong>Mouse/Touch</strong> - Click directional buttons</li>
                            <li><strong>R Key</strong> - Reset current level</li>
                            <li><strong>H Key</strong> - Toggle level hint</li>
                        </ul>
                    </div>

                    <!-- Game Elements -->
                    <div class="bg-gray-50 rounded-lg p-5">
                        <h3 class="text-lg font-bold text-gray-800 mb-3">
                            <i class="fas fa-puzzle-piece text-orange-600 mr-2"></i>Game Elements
                        </h3>
                        <div class="grid grid-cols-2 gap-2 text-sm text-gray-700">
                            <div>🚪 <strong>Exit</strong> - Your goal!</div>
                            <div>⚡ <strong>Switch</strong> - Toggles doors</div>
                            <div>🚫 <strong>Door</strong> - Blocks path</div>
                            <div>💀 <strong>Trap</strong> - Avoid at all costs!</div>
                        </div>
                    </div>
                </div>

                <!-- Key Strategy Tips -->
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                    <h3 class="text-lg font-bold text-yellow-800 mb-2">
                        <i class="fas fa-lightbulb mr-2"></i>Key Strategy Tips
                    </h3>
                    <ul class="space-y-1 text-sm text-yellow-700">
                        <li>• <strong>Mirror Logic:</strong> Only left-right movement is mirrored, up-down stays the same</li>
                        <li>• <strong>Independent Movement:</strong> If one avatar is blocked, the other can still move</li>
                        <li>• <strong>Door Timing:</strong> Don't stand on doors when they close - you'll get trapped!</li>
                        <li>• <strong>Both Must Win:</strong> Both avatars must reach their exits simultaneously</li>
                    </ul>
                </div>

                <!-- Progressive Difficulty -->
                <div class="mb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-3">
                        <i class="fas fa-chart-line text-purple-600 mr-2"></i>Progressive Challenge
                    </h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <div class="text-center bg-green-50 rounded-lg p-3">
                            <div class="text-2xl mb-1">📚</div>
                            <div class="text-xs font-bold">Levels 1-2</div>
                            <div class="text-xs text-gray-600">Tutorial</div>
                        </div>
                        <div class="text-center bg-yellow-50 rounded-lg p-3">
                            <div class="text-2xl mb-1">⚡</div>
                            <div class="text-xs font-bold">Levels 3-4</div>
                            <div class="text-xs text-gray-600">Switches</div>
                        </div>
                        <div class="text-center bg-orange-50 rounded-lg p-3">
                            <div class="text-2xl mb-1">💀</div>
                            <div class="text-xs font-bold">Levels 5-6</div>
                            <div class="text-xs text-gray-600">Traps</div>
                        </div>
                        <div class="text-center bg-red-50 rounded-lg p-3">
                            <div class="text-2xl mb-1">🏆</div>
                            <div class="text-xs font-bold">Levels 7-8</div>
                            <div class="text-xs text-gray-600">Master</div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-3">
                    <button @click="startGame()" class="btn btn-primary btn-lg flex-1">
                        <i class="fas fa-play mr-2"></i>Start Playing!
                    </button>
                    <button @click="showWelcome = false; showInstructions = true" class="btn btn-outline btn-lg">
                        <i class="fas fa-book mr-2"></i>Detailed Rules
                    </button>
                    <button @click="showWelcome = false" class="btn btn-ghost btn-lg">
                        <i class="fas fa-times mr-2"></i>Skip Tutorial
                    </button>
                </div>

                <!-- Don't show again option -->
                <div class="mt-4 text-center">
                    <label class="label cursor-pointer justify-center gap-2">
                        <input type="checkbox" x-model="dontShowWelcomeAgain" class="checkbox checkbox-sm">
                        <span class="label-text text-sm">Don't show this tutorial again</span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <script>
        function mirrorMazeGame() {
            return {
                // Game state
                currentLevel: 1,
                totalLevels: 8,
                completedLevels: 0,
                boardSize: 6,
                moves: 0,
                levelStartTime: 0,
                levelTime: 0,
                gameTimer: null,
                gameWon: false,
                
                // Level completion data
                showLevelComplete: false,
                levelCompleteTime: 0,
                levelCompleteMoves: 0,
                
                // Board states
                board: [],
                mirrorBoard: [],
                originalBoard: [],
                originalMirrorBoard: [],
                
                // Player positions
                playerReal: { x: 0, y: 0 },
                playerMirror: { x: 0, y: 0 },
                
                // Blocked status (when standing on a door that closes)
                realBlocked: false,
                mirrorBlocked: false,
                
                // UI state
                showInstructions: false,
                showLevelSelect: false,
                showHint: false,
                showToast: false,
                toastMessage: '',
                toastType: 'success',
                showWelcome: false,
                dontShowWelcomeAgain: false,
                
                // Level definitions
                levels: [
                    {
                        // Level 1: Tutorial
                        size: 6,
                        realStart: { x: 1, y: 3},
                        mirrorStart: { x: 4, y: 2 },
                        board: [
                            ['wall', 'wall', 'wall', 'wall', 'wall', 'wall'],
                            ['wall', 'wall', 'wall', 'wall', 'wall', 'wall'],
                            ['exit', 'floor', 'floor', 'floor', 'floor', 'exit'],
                            ['wall', 'floor', 'floor', 'floor', 'floor', 'wall'],
                            ['wall', 'wall', 'wall', 'wall', 'wall', 'wall'],
                            ['wall', 'wall', 'wall', 'wall', 'wall', 'wall']
                        ],
                        hint: "Press RIGHT to move toward your exit. Your mirror moves LEFT toward the opposite exit!"
                    },
                    {
                        // Level 2: Switch introduction
                        size: 6,
                        realStart: { x: 0, y: 0 },
                        mirrorStart: { x: 5, y: 5 },
                        board: [
                            ['floor', 'floor', 'door', 'floor', 'floor', 'exit'],
                            ['floor', 'wall', 'wall', 'wall', 'wall', 'floor'],
                            ['floor', 'wall', 'switch', 'floor', 'floor', 'floor'],
                            ['floor', 'wall', 'floor', 'switch', 'wall', 'floor'],
                            ['floor', 'wall', 'wall', 'wall', 'wall', 'floor'],
                            ['floor', 'floor', 'door', 'floor', 'floor', 'floor']
                        ],
                        hint: "Hit switches (⚡) to toggle doors. Plan your path carefully!"
                    },
                    {
                        // Level 3: Trap avoidance
                        size: 6,
                        realStart: { x: 0, y: 0 },
                        mirrorStart: { x: 5, y: 5 },
                        board: [
                            ['floor', 'floor', 'trap', 'trap', 'floor', 'exit'],
                            ['floor', 'wall', 'wall', 'wall', 'wall', 'floor'],
                            ['floor', 'wall', 'wall', 'wall', 'wall', 'floor'],
                            ['floor', 'wall', 'wall', 'wall', 'floor', 'floor'],
                            ['floor', 'wall', 'wall', 'wall', 'wall', 'floor'],
                            ['exit', 'floor', 'wall', 'trap', 'floor', 'floor']
                        ],
                        hint: "Navigate around the traps! Use the safe corridors on the sides."
                    },
                    {
                        // Level 4: Complex switch puzzle
                        size: 7,
                        realStart: { x: 0, y: 0 },
                        mirrorStart: { x: 6, y: 6 },
                        board: [
                            ['floor', 'door', 'floor', 'switch', 'floor', 'door', 'floor'],
                            ['floor', 'wall', 'floor', 'wall', 'floor', 'wall', 'floor'],
                            ['floor', 'wall', 'floor', 'wall', 'floor', 'wall', 'floor'],
                            ['switch', 'wall', 'floor', 'floor', 'floor', 'wall', 'switch'],
                            ['floor', 'wall', 'floor', 'wall', 'floor', 'wall', 'floor'],
                            ['floor', 'wall', 'floor', 'wall', 'floor', 'wall', 'floor'],
                            ['exit', 'door', 'floor', 'switch', 'floor', 'door', 'exit']
                        ],
                        hint: "Multiple switches control different doors. Think ahead!"
                    },
                    {
                        // Level 5: Narrow passages
                        size: 8,
                        realStart: { x: 0, y: 3 },
                        mirrorStart: { x: 7, y: 4 },
                        board: [
                            ['wall', 'door', 'wall', 'wall', 'wall', 'wall', 'door', 'exit'],
                            ['wall', 'floor', 'wall', 'switch', 'wall', 'floor', 'wall', 'floor'],
                            ['wall', 'floor', 'wall', 'floor', 'wall', 'floor', 'wall', 'floor'],
                            ['floor', 'floor', 'floor', 'floor', 'floor', 'floor', 'floor', 'floor'],
                            ['floor', 'floor', 'floor', 'floor', 'floor', 'floor', 'floor', 'floor'],
                            ['wall', 'floor', 'wall', 'floor', 'wall', 'floor', 'wall', 'floor'],
                            ['wall', 'floor', 'wall', 'switch', 'wall', 'floor', 'wall', 'floor'],
                            ['exit', 'door', 'wall', 'wall', 'wall', 'wall', 'door', 'wall']
                        ],
                        hint: "Hit switches to open doors blocking the exits. Plan your path through the narrow corridors!"
                    },
                    {
                        // Level 6: Timing puzzle
                        size: 6,
                        realStart: { x: 0, y: 2 },
                        mirrorStart: { x: 5, y: 3 },
                        board: [
                            ['wall', 'wall', 'wall', 'wall', 'wall', 'wall'],
                            ['wall', 'switch', 'door', 'door', 'switch', 'wall'],
                            ['floor', 'floor', 'floor', 'floor', 'floor', 'floor'],
                            ['floor', 'floor', 'floor', 'floor', 'floor', 'floor'],
                            ['wall', 'switch', 'door', 'door', 'switch', 'wall'],
                            ['wall', 'wall', 'exit', 'exit', 'wall', 'wall']
                        ],
                        hint: "Navigate the corridors to hit switches, then move through the opened doors to reach the exits!"
                    },
                    {
                        // Level 7: Maze runner
                        size: 8,
                        realStart: { x: 0, y: 0 },
                        mirrorStart: { x: 7, y: 7 },
                        board: [
                            ['floor', 'wall', 'floor', 'trap', 'trap', 'floor', 'wall', 'exit'],
                            ['floor', 'wall', 'floor', 'wall', 'wall', 'floor', 'wall', 'floor'],
                            ['floor', 'switch', 'floor', 'wall', 'wall', 'floor', 'switch', 'floor'],
                            ['door', 'wall', 'floor', 'floor', 'floor', 'floor', 'wall', 'door'],
                            ['door', 'wall', 'floor', 'floor', 'floor', 'floor', 'wall', 'door'],
                            ['floor', 'switch', 'floor', 'wall', 'wall', 'floor', 'switch', 'floor'],
                            ['floor', 'wall', 'floor', 'wall', 'wall', 'floor', 'wall', 'floor'],
                            ['wall', 'wall', 'floor', 'trap', 'trap', 'floor', 'wall', 'floor']
                        ],
                        hint: "Complex maze with multiple paths. Choose wisely!"
                    },
                    {
                        // Level 8: Master challenge
                        size: 9,
                        realStart: { x: 1, y: 1 },
                        mirrorStart: { x: 7, y: 7 },
                        board: [
                            ['wall', 'wall', 'wall', 'wall', 'wall', 'wall', 'wall', 'wall', 'wall'],
                            ['wall', 'floor', 'door', 'trap', 'trap', 'trap', 'door', 'floor', 'wall'],
                            ['wall', 'floor', 'wall', 'floor', 'floor', 'floor', 'wall', 'door', 'wall'],
                            ['wall', 'floor', 'floor', 'switch', 'floor', 'switch', 'floor', 'floor', 'wall'],
                            ['wall', 'trap', 'trap', 'wall', 'exit', 'wall', 'trap', 'trap', 'wall'],
                            ['wall', 'trap', 'trap', 'switch', 'wall', 'switch', 'trap', 'trap', 'wall'],
                            ['wall', 'door', 'wall', 'trap', 'trap', 'trap', 'wall', 'door', 'wall'],
                            ['wall', 'floor', 'door', 'floor', 'floor', 'floor', 'door', 'floor', 'wall'],
                            ['wall', 'wall', 'wall', 'wall', 'exit', 'wall', 'wall', 'wall', 'wall']
                        ],
                        hint: "The ultimate challenge! Master both timing and strategy."
                    }
                ],
                
                init() {
                    this.loadLevel(1);
                    this.startLevelTimer();
                    this.setupKeyboardControls();
                    this.loadProgress();
                    this.checkWelcomeStatus();
                },
                
                loadLevel(levelNum) {
                    const level = this.levels[levelNum - 1];
                    if (!level) return;
                    
                    this.currentLevel = levelNum;
                    this.boardSize = level.size;
                    this.playerReal = { ...level.realStart };
                    this.playerMirror = { ...level.mirrorStart };
                    this.moves = 0;
                    this.gameWon = false;
                    
                    // Reset level timer
                    this.levelStartTime = Date.now();
                    this.levelTime = 0;
                    this.showLevelComplete = false;
                    
                    // Reset blocked status
                    this.realBlocked = false;
                    this.mirrorBlocked = false;
                    
                    // Deep clone the board
                    this.board = level.board.map(row => [...row]);
                    this.mirrorBoard = level.board.map(row => [...row]);
                    this.originalBoard = level.board.map(row => [...row]);
                    this.originalMirrorBoard = level.board.map(row => [...row]);
                    
                    this.showHint = false;
                },
                
                movePlayer(direction) {
                    if (this.gameWon) return;
                    
                    const directions = {
                        up: { x: 0, y: 1 },
                        down: { x: 0, y: -1 },
                        left: { x: -1, y: 0 },
                        right: { x: 1, y: 0 }
                    };
                    
                    // Mirror directions (only left-right is mirrored, up-down stays the same)
                    const mirrorDirections = {
                        up: { x: 0, y: 1 },    // Same as real world
                        down: { x: 0, y: -1 },   // Same as real world
                        left: { x: 1, y: 0 },   // Mirrored: left becomes right
                        right: { x: -1, y: 0 }  // Mirrored: right becomes left
                    };
                    
                    const realMove = directions[direction];
                    const mirrorMove = mirrorDirections[direction];
                    
                    const newRealPos = {
                        x: this.playerReal.x + realMove.x,
                        y: this.playerReal.y + realMove.y
                    };
                    
                    const newMirrorPos = {
                        x: this.playerMirror.x + mirrorMove.x,
                        y: this.playerMirror.y + mirrorMove.y
                    };
                    
                    // Check if moves are valid for each avatar independently
                    // Also check if avatars are blocked by being trapped on closed doors
                    const realValid = !this.realBlocked && this.isValidMove(newRealPos, this.board);
                    const mirrorValid = !this.mirrorBlocked && this.isValidMove(newMirrorPos, this.mirrorBoard);
                    
                    // Track which avatars will actually move
                    let realWillMove = false;
                    let mirrorWillMove = false;
                    let actualRealPos = this.playerReal;
                    let actualMirrorPos = this.playerMirror;
                    
                    // Check for traps before moving
                    if (realValid) {
                        const realCell = this.board[newRealPos.y][newRealPos.x];
                        if (realCell === 'trap') {
                            this.showToastMessage('Real avatar hit a trap! Level reset.', 'error');
                            this.resetLevel();
                            return;
                        } else {
                            realWillMove = true;
                            actualRealPos = newRealPos;
                        }
                    }
                    
                    if (mirrorValid) {
                        const mirrorCell = this.mirrorBoard[newMirrorPos.y][newMirrorPos.x];
                        if (mirrorCell === 'trap') {
                            this.showToastMessage('Mirror avatar hit a trap! Level reset.', 'error');
                            this.resetLevel();
                            return;
                        } else {
                            mirrorWillMove = true;
                            actualMirrorPos = newMirrorPos;
                        }
                    }
                    
                    // If neither avatar can move, just return without showing message
                    if (!realWillMove && !mirrorWillMove) {
                        return;
                    }
                    
                    // Move the avatars that can move
                    this.playerReal = actualRealPos;
                    this.playerMirror = actualMirrorPos;
                    
                    // Only count as a move if at least one avatar moved
                    this.moves++;
                    
                    // Check for switches
                    const realCell = realWillMove ? this.board[actualRealPos.y][actualRealPos.x] : null;
                    const mirrorCell = mirrorWillMove ? this.mirrorBoard[actualMirrorPos.y][actualMirrorPos.x] : null;
                    this.handleSwitches(realCell, mirrorCell);
                    
                    // Check for victory
                    this.checkVictory();
                    
                    // No feedback messages for partial movement - less distracting
                },
                
                isValidMove(pos, board) {
                    if (pos.x < 0 || pos.x >= this.boardSize || pos.y < 0 || pos.y >= this.boardSize) {
                        return false;
                    }
                    
                    const cell = board[pos.y][pos.x];
                    return cell !== 'wall' && cell !== 'door';
                },
                
                handleSwitches(realCell, mirrorCell) {
                    if ((realCell && realCell === 'switch') || (mirrorCell && mirrorCell === 'switch')) {
                        this.toggleDoors();
                        this.showToastMessage('Switch activated! Doors toggled.', 'success');
                    }
                },
                
                toggleDoors() {
                    // Toggle doors in both boards
                    for (let y = 0; y < this.boardSize; y++) {
                        for (let x = 0; x < this.boardSize; x++) {
                            if (this.board[y][x] === 'door') {
                                this.board[y][x] = 'door_open';
                                // Check if real avatar is standing on this door that's opening (free them)
                                if (this.playerReal.x === x && this.playerReal.y === y && this.realBlocked) {
                                    this.realBlocked = false;
                                    this.showToastMessage('Real avatar freed from door!', 'success');
                                }
                            } else if (this.board[y][x] === 'door_open') {
                                this.board[y][x] = 'door';
                                // Check if real avatar is standing on this door that's closing
                                if (this.playerReal.x === x && this.playerReal.y === y) {
                                    this.realBlocked = true;
                                    this.showToastMessage('Real avatar trapped on closing door!', 'error');
                                }
                            }
                            
                            if (this.mirrorBoard[y][x] === 'door') {
                                this.mirrorBoard[y][x] = 'door_open';
                                // Check if mirror avatar is standing on this door that's opening (free them)
                                if (this.playerMirror.x === x && this.playerMirror.y === y && this.mirrorBlocked) {
                                    this.mirrorBlocked = false;
                                    this.showToastMessage('Mirror avatar freed from door!', 'success');
                                }
                            } else if (this.mirrorBoard[y][x] === 'door_open') {
                                this.mirrorBoard[y][x] = 'door';
                                // Check if mirror avatar is standing on this door that's closing
                                if (this.playerMirror.x === x && this.playerMirror.y === y) {
                                    this.mirrorBlocked = true;
                                    this.showToastMessage('Mirror avatar trapped on closing door!', 'error');
                                }
                            }
                        }
                    }
                    
                    // If both avatars are blocked, reset the level
                    if (this.realBlocked && this.mirrorBlocked) {
                        setTimeout(() => {
                            this.showToastMessage('Both avatars trapped! Resetting level...', 'error');
                            this.resetLevel();
                        }, 1500);
                    }
                },
                
                checkVictory() {
                    const realCell = this.board[this.playerReal.y][this.playerReal.x];
                    const mirrorCell = this.mirrorBoard[this.playerMirror.y][this.playerMirror.x];
                    
                    if (realCell === 'exit' && mirrorCell === 'exit') {
                        this.gameWon = true;
                        this.completedLevels = Math.max(this.completedLevels, this.currentLevel);
                        this.saveProgress();
                        
                        // Capture completion stats
                        this.levelCompleteTime = this.levelTime;
                        this.levelCompleteMoves = this.moves;
                        
                        // Show completion popup after a brief delay
                        setTimeout(() => {
                            this.showLevelComplete = true;
                        }, 300);
                        
                        // Add victory animation
                        setTimeout(() => {
                            const realPlayer = document.querySelector('.player-real');
                            const mirrorPlayer = document.querySelector('.player-mirror');
                            if (realPlayer) realPlayer.classList.add('victory-animation');
                            if (mirrorPlayer) mirrorPlayer.classList.add('victory-animation');
                        }, 100);
                    }
                },
                
                resetLevel() {
                    this.loadLevel(this.currentLevel);
                },
                
                nextLevel() {
                    if (this.currentLevel < this.totalLevels) {
                        this.showLevelComplete = false;
                        this.loadLevel(this.currentLevel + 1);
                    }
                },
                
                selectLevel() {
                    this.showLevelSelect = true;
                },
                
                getCellClass(cell, board) {
                    const baseClass = `cell-${cell.replace('_', '-')}`;
                    return baseClass;
                },
                
                getCurrentHint() {
                    const level = this.levels[this.currentLevel - 1];
                    return level ? level.hint : "No hint available for this level.";
                },
                
                setupKeyboardControls() {
                    document.addEventListener('keydown', (e) => {
                        if (this.showInstructions || this.showLevelSelect || this.showWelcome || this.showLevelComplete) return;
                        
                        switch (e.code) {
                            case 'ArrowUp':
                            case 'KeyW':
                                e.preventDefault();
                                this.movePlayer('up');
                                break;
                            case 'ArrowDown':
                            case 'KeyS':
                                e.preventDefault();
                                this.movePlayer('down');
                                break;
                            case 'ArrowLeft':
                            case 'KeyA':
                                e.preventDefault();
                                this.movePlayer('left');
                                break;
                            case 'ArrowRight':
                            case 'KeyD':
                                e.preventDefault();
                                this.movePlayer('right');
                                break;
                            case 'KeyR':
                                e.preventDefault();
                                this.resetLevel();
                                break;
                            case 'KeyH':
                                e.preventDefault();
                                this.showHint = !this.showHint;
                                break;
                        }
                    });
                },
                
                startLevelTimer() {
                    // Clear existing timer if any
                    if (this.gameTimer) {
                        clearInterval(this.gameTimer);
                    }
                    
                    this.gameTimer = setInterval(() => {
                        if (!this.gameWon && !this.showLevelComplete) {
                            this.levelTime = Math.floor((Date.now() - this.levelStartTime) / 1000);
                        }
                    }, 100); // Update more frequently for accuracy
                },
                
                formatTime(seconds) {
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins}:${secs.toString().padStart(2, '0')}`;
                },
                
                showToastMessage(message, type = 'success') {
                    this.toastMessage = message;
                    this.toastType = type;
                    this.showToast = true;
                    setTimeout(() => {
                        this.showToast = false;
                    }, 3000);
                },
                
                saveProgress() {
                    const progress = {
                        completedLevels: this.completedLevels,
                        currentLevel: this.currentLevel
                    };
                    localStorage.setItem('mirrorMazeProgress', JSON.stringify(progress));
                },
                
                loadProgress() {
                    const saved = localStorage.getItem('mirrorMazeProgress');
                    if (saved) {
                        try {
                            const progress = JSON.parse(saved);
                            this.completedLevels = progress.completedLevels || 0;
                        } catch (e) {
                            console.error('Failed to load progress:', e);
                        }
                    }
                },
                
                checkWelcomeStatus() {
                    // Check if user has seen the welcome screen before
                    const hasSeenWelcome = localStorage.getItem('mirrorMazeWelcomeSeen');
                    if (!hasSeenWelcome) {
                        // Show welcome popup after a brief delay to ensure page is fully loaded
                        setTimeout(() => {
                            this.showWelcome = true;
                        }, 500);
                    }
                },
                
                startGame() {
                    // Hide welcome popup and save preference if checkbox is checked
                    this.showWelcome = false;
                    if (this.dontShowWelcomeAgain) {
                        localStorage.setItem('mirrorMazeWelcomeSeen', 'true');
                    }
                    
                    // Show hint for first-time players
                    this.showHint = true;
                },
                
                saveWelcomePreference() {
                    if (this.dontShowWelcomeAgain) {
                        localStorage.setItem('mirrorMazeWelcomeSeen', 'true');
                    }
                }
            }
        }
    </script>
</body>
</html>
